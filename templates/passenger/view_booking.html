{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Dashboard</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Travelix Project">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- CSS Links -->
    <link rel="stylesheet" type="text/css" href="{% static 'pass/styles/bootstrap4/bootstrap.min.css'%}">
    <link rel="stylesheet" href="{% static 'pass/plugins/font-awesome-4.7.0/css/font-awesome.min.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'pass/styles/elements_styles.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'pass/styles/elements_responsive.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'pass/plugins/OwlCarousel2-2.2.1/owl.carousel.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'pass/plugins/OwlCarousel2-2.2.1/owl.theme.default.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'pass/plugins/OwlCarousel2-2.2.1/animate.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'pass/styles/main_styles.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'pass/styles/responsive.css'%}">
    
    <style>
        body {
        margin: 0;
        padding: 0;
        background-color: #f0f8ff;
        overflow-y: auto; /* Enable vertical scrollbar if needed */
        }
        .home_slider_container {
            height: 700vh; /* Increased height */
        }
        .home_slider_background {
            height: 100%;
            background-size: cover;
            background-position: center;
        }
        .home_slider_content {
            position: relative;
            z-index: 1;
            color: white;
        }    
        .text-center {
            text-align: center;
        }
		.animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1; /* Send behind other content */
        }
        .circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 165, 0, 0.6);
            animation: float 6s infinite ease-in-out;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }
        .circle1 { width: 100px; height: 100px; top: 20%; left: 10%; animation-duration: 4s; }
        .circle2 { width: 150px; height: 150px; top: 30%; left: 70%; animation-duration: 5s; }
        .circle3 { width: 80px; height: 80px; top: 70%; left: 40%; animation-duration: 6s; }
        .circle4 { width: 120px; height: 120px; top: 50%; left: 80%; animation-duration: 3s; }
        .table-container {
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 200px; /* only top margin now */
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 1;
            overflow-y: auto;
            max-height: 70vh;
            width: 110%; /* Keep as you said */
            max-width: 1500px;
        }
        
        
        th, td {
			color: #333;
            text-align: center;
        }
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
		.text-center {
            color: #333; /* Dark grey color */
        }
        .super_container {
            min-height: 100vh; /* Ensure it occupies at least full viewport height */
            display: flex;
            flex-direction: column;
        }
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .table tbody tr {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .table tbody tr.show {
            opacity: 1;
            transform: translateY(0);
        }
        th, td {
            text-align: center; /* Center align table headers and cells */
        }		
        .table tbody tr {
          opacity: 0;
          transform: translateY(20px);
          transition: opacity 0.5s ease, transform 0.5s ease;
      }
      
      .table tbody tr.show {
          opacity: 1;
          transform: translateY(0);
      }
      
      th, td {
          text-align: center; /* Center align table headers and cells */
      }
    </style>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
</head>
<body>
    <div class="super_container">

        <!-- Header -->
        <header class="header">
            <!-- Top Bar -->
            <div class="top_bar">
                <div class="container">
                    <div class="row">
                        <div class="col d-flex flex-row">
                            <div class="phone">+91 9897654387</div>
                            <div class="social">
                                <ul class="social_list">
                                    <li class="social_list_item"><a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li>
                                    <li class="social_list_item"><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                                    <li class="social_list_item"><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                                    <li class="social_list_item"><a href="#"><i class="fa fa-dribbble" aria-hidden="true"></i></a></li>
                                    <li class="social_list_item"><a href="#"><i class="fa fa-behance" aria-hidden="true"></i></a></li>
                                    <li class="social_list_item"><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Navigation -->
            <nav class="main_nav">
                <div class="container">
                    <div class="row">
                        <div class="col main_nav_col d-flex flex-row align-items-center justify-content-start">
                            <div class="logo_container">
                                <div class="logo"><a href="#"><img src="{% static 'pass/images/logo.png'%}" alt="">travelix</a></div>
                            </div>
                            <div class="main_nav_container ml-auto">
                                <ul class="main_nav_list">
                                  <li class="main_nav_item"><a href="{% url 'passenger_dashboard' %}">home</a></li>
                                  <li class="main_nav_item"><a href="{% url 'passenger_about' %}">about us</a></li>
                                  <li class="main_nav_item"><a href="{% url 'passenger_offers' %}">offers</a></li>
                                  <li class="main_nav_item"><a href="{% url 'passenger_blog' %}">news</a></li>
                                  <li class="main_nav_item"><a href="{% url 'passenger_contact' %}">contact</a></li>
                                </ul>
                            </div>
                            <div class="content_search ml-lg-0 ml-auto">
                                <form id="search_form" class="search_form bez_1">
                                    <input type="search" class="search_content_input bez_1">
                                </form>
                                <div class="hamburger">
                                    <i class="fa fa-bars trans_200"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <!-- Home -->
        <div class="home">
            <!-- Home Slider -->
            <div class="home_slider_container">
                <div class="owl-carousel home_slider owl-theme">
                    <!-- Slider Item 1 -->
                    <div class="home_slider_item">
                        <div class="home_slider_background" style="background-image:url({% static 'pass/images/home_slider.jpg'%})"></div>
                        <div class="home_slider_content text-center">
                            <div class="home_slider_content_inner">
                                <h1>discover</h1>
                                <h1>the world with us</h1>
                            </div>
                        </div>
                    </div>
                    <!-- Additional Slider Items -->
                    <div class="home_slider_item">
                        <div class="home_slider_background" style="background-image:url({% static 'pass/images/home_slider.jpg'%})"></div>
                        <div class="home_slider_content text-center">
                            <div class="home_slider_content_inner">
                                <h1>discover</h1>
                                <h1>the world through us</h1>
                            </div>
                        </div>
                    </div>
                    <div class="home_slider_item">
                        <div class="home_slider_background" style="background-image:url({% static 'pass/images/home_slider.jpg'%})"></div>
                        <div class="home_slider_content text-center">
                            <div class="home_slider_content_inner">
                                <h1>discover</h1>
                                <h1>the world around us</h1>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="animated-background">
                    <div class="circle circle1"></div>
                    <div class="circle circle2"></div>
                    <div class="circle circle3"></div>
                    <div class="circle circle4"></div>
                </div>
                
                <div class="container">
                  <div class="table-container fade-in">
                    <div class="search-section">
                        <div class="search_content">
                          <div class="search_tabs_container">
                            
                          </div>
                          <div class="search_panel active">
                            <form id="search_form_1" class="search_panel_content d-flex flex-lg-row flex-column align-items-lg-center align-items-start justify-content-lg-between justify-content-start">
                              <div class="search_item">
                                <div style="color: #777777; margin-left: 5px;">Search Bookings</div>

                                <input type="text" id="bookingSearch" class="destination search_input" placeholder="Enter booking info" onkeyup="filterBookingTable()">
                              </div>
                              <div class="search_item">
                                <div style="color: #777777; margin-left: 5px;">Status</div>
                                <select id="statusFilter" class="dropdown_item_select search_input" onchange="filterBookingTable()">
                                  <option value="">All Statuses</option>
                                  <option value="Confirmed">Confirmed</option>
                                  <option value="Cancelled">Cancelled</option>
                                  <option value="Pending">Pending</option>
                                  <option value="Completed">Completed</option>
                                </select>
                              </div>
                              <div class="search_item">
                                <div style="color: #777777; margin-left: 5px;">Time Period</div>
                                <select id="timePeriod" class="dropdown_item_select search_input" onchange="filterBookingTable()">
                                  <option value="">All Time</option>
                                  <option value="1">Last 1 Month</option>
                                  <option value="2">Last 2 Months</option>
                                  <option value="3">Last 3 Months</option>
                                  <option value="5">Last 5 Months</option>
                                  <option value="12">Last 1 Year</option>
                                </select>
                              </div>
                              
                              <div class="search_item">
                                <button 
                                  type="button" 
                                  class="button search_button" 
                                  style="border-radius: 20px 0 0 20px; height: 50px; width: 136px; text-align: center; display: flex; align-items: center; justify-content: center; margin-top: 10px;"
                                  onclick="clearFilters()">Clear
                                </button>
                              </div>
                              
                              
                            </form>
                          </div>
                        </div>
                      </div>
                    <br>
                      <h2 class="text-center">Booking Details</h2>
                      <table id="bookingTable" class="table table-striped table-bordered">
                          <thead>
                              <tr>
                                  <th>Booking ID</th>
                                  <th>Payment Date</th>
                                  <th>Amount</th>
                                  <th>Payment Method</th>
                                  <th>Seat Number</th>
                                  <th>Booking Status</th>
                                  <th>Source</th>
                                  <th>Destination</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody>
                            {% for booking in booking_data %}
                            <tr>
                                <td>{{ booking.booking_id }}</td>
                                <td>{{ booking.payment_date }}</td>
                                <td>{{ booking.amount }}</td>
                                <td>{{ booking.payment_method }}</td>
                                <td>{{ booking.seat_number }}</td>
                                <td>{{ booking.status }}</td>
                                <td>{{ booking.source }}</td>
                                <td>{{ booking.destination }}</td>
                                <td>
                                    <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;">
                                        {% if booking.status != "Cancelled" and not booking.is_departure_passed and booking.status != "Completed" %}
                                    </div>
                                    
                                    <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;">
                                        <a href="javascript:void(0);" onclick="cancelBooking({{ booking.booking_id }})">Cancel Booking</a>
                                    </div>
                                
                                    <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;">
                                        <a href="{% url 'view_snack_details' booking.booking_id %}">View Snack Orders</a>
                                    </div>
                                    
                                    <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;">
                                        <a href="{% url 'order_snacks' booking.booking_id %}">Order Snacks</a>
                                    </div>
                                
                                    {% endif %}
                                    <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;">
                                        <a href="{% url 'passenger_booking_details' booking.booking_id %}">View Details</a>
                                    </div>
                                </td>
                                
                               
                                  
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="9">No bookings found.</td>
                            </tr>
                            {% endfor %}
                            
                        </tbody>
                        <tr id="noResultsRow" style="display: none;">
                            <td colspan="9" style="text-align: center; color: #777;">No results found.</td>
                          </tr>
                      </table>
                      
                      
                  </div>
              </div>
          </div>
      </div>

            </div>
        </div>    
    </div>
	<!-- Footer -->
        <footer class="footer">
		<div class="container">
			<div class="row">

				<!-- Footer Column -->
				<div class="col-lg-3 footer_column">
					<div class="footer_col">
						<div class="footer_content footer_about">
							<div class="logo_container footer_logo">
								<div class="logo"><a href="#"><img src="{% static 'pass/images/logo.png'%}" alt="">travelix</a></div>
							</div>
							<p class="footer_about_text"> With our user-friendly platform, extensive range of routes, and commitment to exceptional service, we strive to make every journey memorable. Whether you’re booking a bus ticket or exploring our exciting tours, you can trust us to deliver convenience, reliability, and quality. Join our community of satisfied travelers today and embark on your next adventure with confidence.</p>
							<ul class="footer_social_list">
								<li class="footer_social_item"><a ><i class="fa fa-pinterest"></i></a></li>
								<li class="footer_social_item"><a ><i class="fa fa-facebook-f"></i></a></li>
								<li class="footer_social_item"><a ><i class="fa fa-twitter"></i></a></li>
								<li class="footer_social_item"><a ><i class="fa fa-dribbble"></i></a></li>
								<li class="footer_social_item"><a ><i class="fa fa-behance"></i></a></li>
							</ul>
						</div>
					</div>
				</div>

				<!-- Footer Column -->
				<div class="col-lg-3 footer_column">
					<div class="footer_col">
						<div class="footer_title">More...</div>
						<div class="footer_content footer_blog">
							
							<!-- Footer blog item -->
							<div class="footer_blog_item clearfix">
								<div class="footer_blog_image"><img src="{% static 'pass/images/footer_blog_1.jpg'%}" alt="https://unsplash.com/@avidenov"></div>
								<div class="footer_blog_content">
									<div class="footer_blog_title"><a >Discover New Horizons</a></div>
									
								</div>
							</div>
							
							<!-- Footer blog item -->
							<div class="footer_blog_item clearfix">
								<div class="footer_blog_image"><img src="{% static 'pass/images/footer_blog_2.jpg'%}" alt="https://unsplash.com/@deannaritchie"></div>
								<div class="footer_blog_content">
									<div class="footer_blog_title"><a>Uncover Hidden Gems</a></div>
									
								</div>
							</div>

							<!-- Footer blog item -->
							<div class="footer_blog_item clearfix">
								<div class="footer_blog_image"><img src="{% static 'pass/images/footer_blog_3.jpg'%}" alt="https://unsplash.com/@bergeryap87"></div>
								<div class="footer_blog_content">
									<div class="footer_blog_title"><a >Explore More in 2024</a></div>
									
								</div>
							</div>

						</div>
					</div>
				</div>

				<!-- Footer Column -->
				<div class="col-lg-3 footer_column">
					<div class="footer_col">
						<div class="footer_title">tags</div>
						<div class="footer_content footer_tags">
							<ul class="tags_list clearfix">
								<li class="tag_item"><a href="">design</a></li>
								<li class="tag_item"><a href="">fashion</a></li>
								<li class="tag_item"><a href="">music</a></li>
								<li class="tag_item"><a href="">video</a></li>
								<li class="tag_item"><a href="">party</a></li>
								<li class="tag_item"><a href="">photography</a></li>
								<li class="tag_item"><a href="">adventure</a></li>
								<li class="tag_item"><a href="">travel</a></li>
							</ul>
						</div>
					</div>
				</div>

				<!-- Footer Column -->
				<div class="col-lg-3 footer_column">
					<div class="footer_col">
						<div class="footer_title">contact info</div>
						<div class="footer_content footer_contact">
							<ul class="contact_info_list">
                            <li class="contact_info_item d-flex flex-row">
									<div><div class="contact_info_icon"><img src="{% static 'pass/images/placeholder.svg'%}" alt=""></div></div>
									<div class="contact_info_text">NH-66, Vyttila, Aroor Bypass, near to Kundanoor, Maradu, Kochi, Kerala 682304</div>
								</li>
								<li class="contact_info_item d-flex flex-row">
									<div><div class="contact_info_icon"><img src="{% static 'pass/images/phone-call.svg'%}" alt=""></div></div>
									<div class="contact_info_text">+91 9897654387</div>
								</li>
								<li class="contact_info_item d-flex flex-row">
									<div><div class="contact_info_icon"><img src="{% static 'pass/images/message.svg'%}" alt=""></div></div>
									<div class="contact_info_text"><a href="mailto:contactme@gmail.com?Subject=Hello" target="_top">travelix@gmail.com</a></div>
								</li>
								<li class="contact_info_item d-flex flex-row">
                                    <div><div class="contact_info_icon"><img src="{% static 'pass/images/planet-earth.svg'%}" alt=""></div></div>
                                    <div class="contact_info_text"><a href="{% url 'passenger_dashboard' %}">www.travelix.com</a></div>
                                </li>
							</ul>
						</div>
					</div>
				</div>

			</div>
		</div>
	</footer>
</div>

<script>
    function cancelBooking(bookingId) {
        if (confirm("Are you sure you want to cancel this booking? ")) {
            fetch(`/cancel-booking/${bookingId}/`, {
                method: 'GET',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    window.location.href = data.redirect;
                } else {
                    console.error("Server Error:", data);
                    alert("Error: " + data.error);
                }
            })
            .catch(error => {
                console.error("Fetch Error:", error);
                alert("Something went wrong. Please check the console.");
            });
        }
    }
    
    
</script>

<!-- Add this inside your booking table -->


<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function() {
        // Show table rows with animation
        $('#submissionTable tr').each(function(index) {
            $(this).delay(index * 200).queue(function(next) {
                $(this).addClass('show');
                next();
            });
        });
    });
</script>

<!-- Add this script to adjust the table height -->
<script>
    function adjustTableHeight() {
        const footerHeight = document.querySelector('.footer').offsetHeight; // Get footer height
        const windowHeight = window.innerHeight; // Get viewport height
        const tableContainer = document.querySelector('.table-container');

        // Calculate available height: subtract footer height, margin, and any additional spacing
        const marginTop = 300; // The margin you set
        const additionalSpacing = 100; // Any extra spacing you want above the footer

        // Set the max height of the table container
        tableContainer.style.maxHeight = `${windowHeight - footerHeight - marginTop - additionalSpacing}px`;
    }

    // Call function on load
    window.onload = adjustTableHeight;

    // Call function on resize
    window.onresize = adjustTableHeight;
</script>
<script>
  window.onload = function() {
      const rows = document.querySelectorAll('.table tbody tr');  // Select all rows
      rows.forEach((row, index) => {
          setTimeout(() => {
              row.classList.add('show');  // Add the 'show' class after a delay
          }, index * 200);  // Increased delay to 200ms between rows for a slower staggered effect
      });
  };
</script>

<!-- Add this script to handle the search and filter functionality -->
<script>
    function parseCustomDate(dateStr) {
        const parts = dateStr.split(', ');
        if (parts.length < 2) return null;
    
        const datePart = parts[0].replace('.', ''); // "Feb. 24" → "Feb 24"
        const year = parts[1].split(',')[0]; // "2025"
        return new Date(`${datePart}, ${year}`);
    }

    function filterBookingTable() {
        const searchInput = document.getElementById("bookingSearch")?.value.toLowerCase() || "";
        const statusFilter = document.getElementById("statusFilter")?.value.toLowerCase() || "";
        const timePeriod = parseInt(document.getElementById("timePeriod")?.value || "0"); // in months

        let startDate = null;
        if (timePeriod > 0) {
            const now = new Date();
            startDate = new Date();
            startDate.setMonth(now.getMonth() - timePeriod);
        }

        const table = document.getElementById("bookingTable");
        const rows = table.querySelectorAll("tbody tr:not(#noResultsRow)");

        let anyVisible = false;

        rows.forEach(row => {
            const tds = row.getElementsByTagName("td");
            if (!tds.length) return;

            const bookingText = Array.from(tds).slice(0, -1).map(td => td.innerText.toLowerCase()).join(" ");
            const statusText = tds[5].innerText.toLowerCase();
            const dateText = tds[1].innerText.trim();
            const paymentDate = parseCustomDate(dateText);

            let show = true;
            if (searchInput && !bookingText.includes(searchInput)) show = false;
            if (statusFilter && statusText !== statusFilter) show = false;
            if (startDate && paymentDate < startDate) show = false;

            row.style.display = show ? "" : "none";
            if (show) anyVisible = true;
        });

        const noResultsRow = document.getElementById("noResultsRow");
        if (noResultsRow) {
            noResultsRow.style.display = anyVisible ? "none" : "";
        }
    }
</script>

<!---Clear Filter-->
<script>
    function clearFilters() {
        const bookingSearch = document.getElementById("bookingSearch");
        const statusFilter = document.getElementById("statusFilter");
        const timePeriod = document.getElementById("timePeriod");

        if (bookingSearch) bookingSearch.value = "";
        if (statusFilter) statusFilter.value = "";
        if (timePeriod) timePeriod.value = "";

        filterBookingTable(); // Reapply the filter after clearing
    }
</script>

    
</body>
</html>